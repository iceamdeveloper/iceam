jQuery(function(r){function n(i){var o=this;this.$element=i,this.$content=i.find("div.item-data"),this.$discount=this.$content.find(".discount"),this.$visibility=this.$content.find(".item_visibility"),this.$price_visibility=this.$content.find(".price_visibility"),this.$allowed_variations=this.$content.find("div.allowed_variations"),this.$default_variation_attributes=this.$content.find("div.default_variation_attributes"),this.$custom_title=this.$content.find("div.custom_title"),this.$custom_description=this.$content.find("div.custom_description"),this.$override_title=this.$content.find(".override_title"),this.$override_description=this.$content.find(".override_description"),this.$hide_thumbnail=this.$content.find(".hide_thumbnail"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".options_group"),this.$priced_individually_input=this.$content.find(".priced_individually input"),this.$override_variations_input=this.$content.find(".override_variations input"),this.$override_defaults_input=this.$content.find(".override_default_variation_attributes input"),this.$override_title_input=this.$override_title.find("input"),this.$override_description_input=this.$override_description.find("input"),this.$price_visibility_product_input=this.$price_visibility.find("input.price_visibility_product"),this.$price_visibility_cart_input=this.$price_visibility.find("input.price_visibility_cart"),this.$price_visibility_order_input=this.$price_visibility.find("input.price_visibility_order"),this.$visibility_product_input=this.$visibility.find("input.visibility_product"),this.$visibility_cart_input=this.$visibility.find("input.visibility_cart"),this.$visibility_order_input=this.$visibility.find("input.visibility_order"),this.$min_qty=this.$content.find(".quantity_min"),this.$min_qty_input=this.$min_qty.find("input.item_quantity"),this.$max_qty=this.$content.find(".quantity_max"),this.$max_qty_input=this.$max_qty.find("input.item_quantity"),this.$default_qty=this.$content.find(".quantity_default"),this.$default_qty_input=this.$default_qty.find("input.item_quantity"),this.max_qty_prev=this.$max_qty_input.val(),this.default_qty_prev=this.$default_qty_input.val(),this.add_error_tip=function(i,t){var e=i.position();0===i.parent().find(".wc_error_tip").length?(i.after('<div class="wc_error_tip">'+t+"</div>"),i.parent().find(".wc_error_tip").css("left",e.left+i.width()-i.width()/2-r(".wc_error_tip").width()/2).css("top",e.top+i.height()+4).fadeIn("100")):i.parent().find(".wc_error_tip").html(t)},this.remove_error_tip=function(i){i.parent().find(".wc_error_tip").fadeOut("100",function(){r(this).remove()})},this.validate_quantity=function(i,t){var e=o.$min_qty_input,n=("max"===i?e=o.$max_qty_input:"default"===i&&(e=o.$default_qty_input),e.val()),d=parseFloat(e.attr("min")),a=parseFloat(e.attr("max")),e=parseFloat(e.attr("step")),s={qty:n,error:""};return 0<=d&&(n<d||isNaN(n))?"max"===i&&""===n||(s.qty="max"===t?o.max_qty_prev:"default"===t?o.default_qty_prev:d,s.error=wc_bundles_admin_params.i18n_qty_low_error.replace("%s",d)):0<a&&a<n?(s.qty="default"===t?o.default_qty_prev:a,s.error=wc_bundles_admin_params.i18n_qty_high_error.replace("%s",a)):0<e&&0<n&&n%e&&(s.qty=e*Math.ceil(n/e),s.error=wc_bundles_admin_params.i18n_qty_step_error.replace("%s",e)),s},this.priced_individually_input_changed=function(){o.$priced_individually_input.is(":checked")?(o.$discount.show(),o.$price_visibility.show()):(o.$discount.hide(),o.$price_visibility.hide())},this.override_variations_input_changed=function(){o.$override_variations_input.is(":checked")?o.$allowed_variations.show():o.$allowed_variations.hide()},this.override_defaults_input_changed=function(){o.$override_defaults_input.is(":checked")?o.$default_variation_attributes.show():o.$default_variation_attributes.hide()},this.override_title_input_changed=function(){o.$override_title_input.is(":checked")?o.$custom_title.show():o.$custom_title.hide()},this.override_description_input_changed=function(){o.$override_description_input.is(":checked")?o.$custom_description.show():o.$custom_description.hide()},this.visibility_product_input_changed=function(){o.$visibility_product_input.is(":checked")?(o.$override_title.show(),o.$override_description.show(),o.$hide_thumbnail.show(),o.override_title_input_changed(),o.override_description_input_changed()):(o.$override_title.hide(),o.$override_description.hide(),o.$hide_thumbnail.hide(),o.$custom_description.hide(),o.$custom_title.hide())},this.toggled_visibility=function(i){o["$visibility_"+i+"_input"].is(":checked")?o["$price_visibility_"+i+"_input"].css("opacity",1):o["$price_visibility_"+i+"_input"].css("opacity",.5)},this.section_changed=function(i){o.$section_links.removeClass("current"),i.addClass("current"),o.$sections.addClass("options_group_hidden"),o.$content.find(".options_group_"+i.data("tab")).removeClass("options_group_hidden")},this.initialize=function(){o.priced_individually_input_changed(),o.override_variations_input_changed(),o.override_defaults_input_changed(),o.override_title_input_changed(),o.override_description_input_changed(),o.visibility_product_input_changed(),o.toggled_visibility("product"),o.toggled_visibility("cart"),o.toggled_visibility("order"),o.$element.sw_select2()},this.initialize()}var d,i,t,e=r("p._wc_pb_edit_in_cart_field"),a=r("select#product-type"),s=r("select#_wc_pb_group_mode"),o=r("#bundled_product_data"),_=o.find(".wc-metaboxes-wrapper"),c=o.find(".toolbar"),l=r(".wc-bundled-items"),u=r(".wc-bundled-item",l),p=r("#bundled_product",o),h={},v=u.length,f={message:null,overlayCSS:{background:"#fff",opacity:.6}},m=o.parent().find("#shipping_product_data"),b=r("input#_virtual"),g=b.prop("checked"),y=!1,$=r("input#_virtual_bundle"),w=m.find(".options_group.bundle_type"),q=w.find(".bundle_type_options li");function k(){0<u.length?(_.removeClass("no-items"),c.removeClass("disabled")):(_.addClass("no-items"),c.addClass("disabled"))}r.fn.wc_bundles_select2=function(){r(document.body).trigger("wc-enhanced-select-init")},r(".bundle_stock_msg").appendTo("._manage_stock_field .description"),r("#_sold_individually").closest(".form-field").addClass("hide_if_bundle"),r("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_bundle"),r(".show_if_simple:not(.hide_if_bundle)").addClass("show_if_bundle"),r("body").on("woocommerce-product-type-change",function(i,t){"bundle"===t&&(r(".show_if_external").hide(),r(".show_if_bundle").show(),r("input#_manage_stock").trigger("change"),r("#_nyp").trigger("change"),y&&$.prop("checked",b.prop("checked")),$.prop("checked")||b.prop("checked",!1).change(),"unassembled"===q.find("input.bundle_type_option:checked").first().val()&&(m.addClass("bundle_unassembled"),o.addClass("bundle_unassembled")))}),r("form#post").on("submit",function(){var i,t,e;"bundle"===a.val()&&(i=r(this),t=r('<input type="hidden" name="pb_post_control_var" value="1"/>'),e=r('<input type="hidden" name="pb_post_test_var" value="1"/>'),i.prepend(t),i.append(e))}),s.on("change",function(){-1===r.inArray(s.val(),wc_bundles_admin_params.group_modes_with_parent)?e.hide():e.show()}),r("input#_downloadable").on("change",function(){a.trigger("change")}),p.on("change",function(){var i=p.val(),i=!!(i&&0<i.length)&&i.shift();if(!i)return!1;p.val([]).trigger("change"),o.block(f),v++;var t={action:"woocommerce_add_bundled_product",post_id:woocommerce_admin_meta_boxes.post_id,id:v,product_id:i,security:wc_bundles_admin_params.add_bundled_product_nonce};return setTimeout(function(){r.post(woocommerce_admin_meta_boxes.ajax_url,t,function(i){var t,e;""!==i.markup?(l.append(i.markup),t=r(".wc-bundled-item",l).last(),e="bundled_item_"+v,t.data("bundled_item_id",e),h[e]=new n(t),o.triggerHandler("wc-bundled-products-changed"),t.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),t.wc_bundles_select2(),o.trigger("wc-bundles-added-bundled-product")):""!==i.message&&window.alert(i.message),p.selectSW("open"),p.selectSW("close"),o.unblock()})},250),!1}),_.on("click",".expand_all",function(){return r(this).hasClass("disabled")||r.each(h,function(i,t){t.$element.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return r(this).hasClass("disabled")||r.each(h,function(i,t){t.$element.addClass("closed").removeClass("open")}),!1}),o.on("wc-bundled-products-changed",function(){(u=r(".wc-bundled-item",l)).each(function(i,t){r(".item_menu_order",t).val(i)}),k()}).one("wc-bundles-added-bundled-product",function(){_.removeClass("wc-bundle-metaboxes-wrapper--boarding")}),l.on("input change","input.item_quantity",function(i){var t,e,n,d=r(this),a=d.closest(".wc-bundled-item").data("bundled_item_id"),s=h[a],a="min",o=(d.hasClass("item_quantity_max")?a="max":d.hasClass("item_quantity_default")&&(a="default"),s.validate_quantity(a,a));o.error?"input"===event.type?setTimeout(function(){s.add_error_tip(d,o.error)},5):d.val(o.qty).change():(s.remove_error_tip(d),"change"===event.type&&(t=s.$min_qty_input.val(),e=s.$max_qty_input.val(),n=s.$default_qty_input.val(),s.$max_qty_input.attr("min",t),"default"!==a&&((o=s.validate_quantity("max",a)).error&&(s.$max_qty_input.val(o.qty),e=o.qty),s.max_qty_prev=e),s.$default_qty_input.attr("min",t),s.$default_qty_input.attr("max",e),(o=s.validate_quantity("default",a)).error&&(s.$default_qty_input.val(o.qty),n=o.qty),s.default_qty_prev=n))}).on("click","a.edit-product",function(i){i.stopPropagation()}).on("click","a.remove_row",function(i){var t=r(this).closest(".wc-bundled-item"),e=t.data("bundled_item_id");t.find("*").off(),t.remove(),delete h[e],o.triggerHandler("wc-bundled-products-changed"),i.preventDefault()}).on("change",".priced_individually input",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].priced_individually_input_changed()}).on("change",".override_variations input",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_variations_input_changed()}).on("change",".override_default_variation_attributes input",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_defaults_input_changed()}).on("change",".override_title input",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_title_input_changed()}).on("change",".override_description input",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].override_description_input_changed()}).on("change","input.visibility_product",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id"),i=h[i];i.visibility_product_input_changed(),i.toggled_visibility("product")}).on("change","input.visibility_cart",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].toggled_visibility("cart")}).on("change","input.visibility_order",function(){var i=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[i].toggled_visibility("order")}).on("click",".subsubsub a",function(i){var t=r(this),e=r(this).closest(".wc-bundled-item").data("bundled_item_id");h[e].section_changed(t),i.preventDefault()}),u.each(function(i){var t=r(this),i="bundled_item_"+i;t.data("bundled_item_id",i),h[i]=new n(t)}),l.sortable({items:".wc-bundled-item",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(i,t){t.item.css("background-color","#f6f6f6")},stop:function(i,t){t.item.removeAttr("style"),o.triggerHandler("wc-bundled-products-changed")}}),k(),w.detach().prependTo(m),m.find(".form-field._weight_field").after(w.find(".form-field.bundle_aggregate_weight_field")),$.on("change",function(){var i=$.prop("checked");b.prop("checked")!==i&&b.prop("checked",i).trigger("change"),i?o.addClass("bundle_virtual"):o.removeClass("bundle_virtual")}),b.on("change",function(){b.prop("checked")!==g&&(y=!0)}),q.on("click",function(){var i=r(this),t=i.find("input").prop("checked","checked").val();q.removeClass("selected"),i.addClass("selected"),"assembled"===t?(m.removeClass("bundle_unassembled"),o.removeClass("bundle_unassembled")):"unassembled"===t&&(m.addClass("bundle_unassembled"),o.addClass("bundle_unassembled"))}),"yes"===wc_bundles_admin_params.is_first_bundle&&(a.val("bundle").trigger("change").trigger("focus"),setTimeout(function(){r(".bundled_products_tab a").trigger("click")},500)),w=o.find(".add_bundled_product"),i=w.find(".sw-expanding-button"),t=r(document.body),i.length?(i.sw_select2(),i.on("click",function(i){i.stopPropagation(),clearTimeout(d);var t=r(this),e=t.find(".select2-search__field");t.addClass("sw-expanding-button--open"),d=setTimeout(function(){e.trigger("focus")},700),p.one("change",function(){t.removeClass("sw-expanding-button--open")})}),t.on("click",".select2-container",function(i){i.stopPropagation()}),t.on("click",function(){i.removeClass("sw-expanding-button--open")})):w.sw_select2(),a.trigger("change"),s.trigger("change")});