!function(e){"use strict";var t={},a=e(document.body);t.search_id=function(e){var t=void 0;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0===e?void 0:t},t.calendar_toggle=function(e){e.find(".calendar-widget-filters-title").hide(),e.find(".calendar-widget-filters-operand").hide();var t=e.find(".calendar-widget-added-filters");if(t.length){var a=t.val()?jQuery.parseJSON(t.val()):new Object,i=0;for(var n in a)i+=a[n].length;i>0&&(e.find(".calendar-widget-filters-title").show(),i>1&&e.find(".calendar-widget-filters-operand").show())}},t.select2=function(){var a=e(this),i={};if(!a.hasClass("select2-container")){if(e("body").hasClass("wp-customizer")&&(i.dropdownCssClass="tribe-customizer-select2"),a.is("select")||(i.id=t.search_id),i.allowClear=!0,a.is("[data-prevent-clear]")&&(i.allowClear=!1),a.is("[data-options]")&&(i.data=a.data("options")),a.is("[data-hide-search]")&&(i.minimumResultsForSearch=1/0),a.is("[multiple]")&&(i.multiple=!0,_.isArray(a.data("separator"))?i.tokenSeparators=a.data("separator"):i.tokenSeparators=[a.data("separator")],i.separator=a.data("separator"),i.regexSeparatorElements=["^("],i.regexSplitElements=["(?:"],e.each(i.tokenSeparators,function(e,t){i.regexSeparatorElements.push("[^"+t+"]+"),i.regexSplitElements.push("["+t+"]")}),i.regexSeparatorElements.push(")$"),i.regexSplitElements.push(")"),i.regexSeparatorString=i.regexSeparatorElements.join(""),i.regexSplitString=i.regexSplitElements.join(""),i.regexToken=new RegExp(i.regexSeparatorString,"ig"),i.regexSplit=new RegExp(i.regexSplitString,"ig")),i.matcher=function(e,t){var a=0==t.toUpperCase().indexOf(e.toUpperCase());if(!a&&"undefined"!=typeof i.tags){var n=_.where(i.tags,{text:t});if(i.tags.length>0&&_.isObject(n)){var r=obj.search_id(n[0]);a=0==r.toUpperCase().indexOf(e.toUpperCase())}}return a},a.is("[data-tags]")&&(i.tags=a.data("options"),i.initSelection=function(t,a){var n=[];e(t.val().split(i.regexSplit)).each(function(){var e={id:this,text:this};if(i.tags.length>0&&_.isObject(i.tags[0])){var t=_.where(i.tags,{value:this});t.length>0&&(e=t[0],e={id:e.value,text:e.text})}n.push(e)}),a(n)},i.createSearchChoice=function(e,t){return e.match(i.regexToken)?{id:e,text:e}:void 0},0===i.tags.length&&(i.formatNoMatches=function(){return a.attr("placeholder")})),a.is("[data-source]")){var n=a.data("source");i.data={results:[]},i.escapeMarkup=function(e){return e},i.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e.data}},i.ajax.data=function(e,t){return{action:"tribe_widget_dropdown_"+n,disabled:a.data("disabled")}}}a.on("open",function(){e(".select2-drop").css("z-index",1e7)}).select2(i)}},t.setup=function(a,i){if("undefined"==typeof i){var i,n=e(a.target);if(!n.parents(".widget-top").length||n.parents("#available-widgets").length)return;i=n.closest("div.widget")}"object"==typeof i&&(i=e(i)),"jQuery"!=typeof i&&i.is('[id*="tribe-"]')&&(0===i.find(".select2-container").length||i.find(".select2-container").hasClass("select2-offscreen"))&&(i.find(".tribe-widget-select2").each(t.select2).on("change",function(){}),i.on("change",".js-tribe-condition",function(){var t=e(this),a=t.data("tribeConditionalField"),n=i.find(".js-tribe-conditional").filter('[data-tribe-conditional-field="'+a+'"]'),r=t.val();n.hide().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.prev(".select2-container").hide()}).filter('[data-tribe-conditional-value="'+r+'"]').show().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.hide().prev(".select2-container").show()})}),e("body").hasClass("wp-customizer")||(e.isNumeric(a)||"widget-updated"===a.type)&&i.find(".js-tribe-condition").trigger("change"))},e(document).on({"widget-added widget-synced widget-updated":t.setup,ready:function(a){e("body").hasClass("wp-customizer")||e('[id*="tribe-"]').each(t.setup)}}).on("change",".calendar-widget-add-filter",function(a){var i=e(this),n=i.parents('.widget[id*="tribe-"]'),r=n.find(".calendar-widget-filters-container"),d=n.find(".calendar-widget-filter-list"),s=n.find(".calendar-widget-added-filters"),o=s.val()?e.parseJSON(s.val()):{},l=a.added,c=i.data("disabled")?i.data("disabled"):[];if(o[l.taxonomy.name]||(o[l.taxonomy.name]=[]),-1!==e.inArray(l.id,o[l.taxonomy.name]))return void i.select2("val","",!1);r.show(),o[l.taxonomy.name].push(l.id),s.val(JSON.stringify(o));var p=e("<a/>").attr({"data-tax":l.taxonomy.name,"data-term":l.id,"class":"calendar-widget-remove-filter",href:"#"}).text("(remove)"),g=e("<span/>").append(p),f=e("<li/>").append("p").html(l.taxonomy.labels.name+": "+l.text+"   ").append(g);d.append(f),t.calendar_toggle(n),c.push(l.id),i.data("disabled",c),i.select2("val","",!1)}).on("click",".calendar-widget-remove-filter",function(a){a.preventDefault();var i=e(this),n=i.parents('.widget[id*="tribe-"]'),r=(n.find(".calendar-widget-filters-container"),n.find(".calendar-widget-filter-list"),n.find(".calendar-widget-added-filters")),d=r.val()?e.parseJSON(r.val()):{},s=i.data("term"),o=i.data("tax");d[o]&&(d[o]=e.grep(d[o],function(e){return e!=s})),r.val(JSON.stringify(d)),i.closest("li").remove(),n.find('input[name^="widget-tribe-"]').trigger("change"),t.calendar_toggle(n)}),a.on("click.widgets-toggle",t.setup)}(jQuery.noConflict());