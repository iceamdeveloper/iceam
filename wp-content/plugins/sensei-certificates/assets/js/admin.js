jQuery(function(e){"use strict";var i,t;window.send_to_editor_default=window.send_to_editor;var a=sensei_certificate_templates_params.primary_image_width,n=sensei_certificate_templates_params.primary_image_height;function r(){e(".field_pos").each(function(i,t){var n=(t=e(t)).attr("id"),r=e("#field"+n),l=e("#certificate_image_0");if(""!=l.attr("src")){var c=1;a!=l.width()&&(c=l.width()/a);var _=t.val()?t.val().split(",").map(function(e){return parseInt(e)*c}):null;0===r.length&&(e("#certificate_image_wrapper").append('<span id="field'+n+'" class="certificate_field" style="display:none;">'+sensei_certificate_templates_params[n]+"</span>"),e("#field"+n).click(function(e){s(e.target.id.substr(6))}),r=e("#field"+n)),_?(r.css({left:_[0]+"px",top:_[1]+"px",width:_[2]+"px",height:_[3]+"px"}),r.show()):r.hide()}else r&&r.hide()})}function s(i){if(e("img#certificate_image_0").attr("src"))if(l(),e("#"+i).val()!=sensei_certificate_templates_params.done_label){e("#field_"+i).hide();var t=e("#_"+i).val()?e("#_"+i).val().split(",").map(function(e){return parseInt(e)}):[null,null,null,null];e("input.set_position").val(sensei_certificate_templates_params.set_position_label),e("#"+i).val(sensei_certificate_templates_params.done_label),e("img#certificate_image_0").imgAreaSelect({show:!0,handles:!0,instance:!0,imageWidth:a,imageHeight:n,x1:t[0],y1:t[1],x2:t[0]+t[2],y2:t[1]+t[3],onSelectEnd:function(t,a){!function(i,t){i&&0!==i.width&&0!==i.height?e("#_"+t).val(i.x1+","+i.y1+","+i.width+","+i.height):s(t);e("#remove_"+t).show()}(a,i)}}),e(document).scrollTop()>e("img#certificate_image_0").offset().top+e("img#certificate_image_0").height()*(2/3)&&e("html, body").animate({scrollTop:e("#title").offset().top},500)}else e("#"+i).val(sensei_certificate_templates_params.set_position_label)}function l(){e("img#certificate_image_0").imgAreaSelect({remove:!0}),r()}function c(){e(".remove-alternative-certificate-image").click(function(){var i=e(this).parent(),t=i;return e("input",t).val(""),e("img",t).attr("src",""),i.hide(),!1})}e("#set-certificate-image, #set-additional-image, #add-alternative-certificate-image").live("click",function(r){r.preventDefault(),t=e(this),i?i.open():((i=wp.media.frames.file_frame=wp.media({title:"Select an Image",button:{text:"Set Image"},multiple:!1})).on("select",function(){var r=i.state().get("selection").first().toJSON();if(a=r.width,n=r.height,"set-certificate-image"==t.attr("id"))e("#upload_image_id_0").val(r.id),e("#remove-certificate-image").show(),e("img#certificate_image_0").attr("src",r.url);else if("set-additional-image"==t.attr("id"))e("#upload_additional_image_id_0").val(r.id),e("#set-additional-image").hide(),e("#remove-additional-image").show(),e("img#certificate_additional_image").attr("src",r.url);else if("add-alternative-certificate-image"==t.attr("id")){var s=e("#certificate_alternative_images li").size()+1;e("#certificate_alternative_images").append('<li class="alternative_image"><a href="#" class="remove-alternative-certificate-image"><img style="max-width:100px;max-height:100px;" src="'+r.url+'" /><input type="hidden" name="upload_image_id['+s+']" class="upload_image_id" value="'+r.id+'" /><span class="overlay"></span></a></li>'),c()}}),i.open())}),e("#remove-certificate-image").click(function(){return e("#upload_image_id_0").val(""),e("img#certificate_image_0").attr("src",""),e(this).hide(),!1}),e(window).resize(function(){r()}),r(),e("input.set_position").click(function(){s(this.id)}),e("input.remove_position").click(function(){e(this).hide(),e("#_"+this.id.substr(7)).val(""),e("#"+this.id.substr(7)).val(sensei_certificate_templates_params.set_position_label),l()}),c(),e("#remove-additional-image").click(function(){return e("#upload_additional_image_id_0").val(""),e("img#certificate_additional_image").attr("src",""),e(this).hide(),e("#set-additional-image").show(),!1}),"function"!=typeof jQuery.fn.hasParent&&jQuery.extend(jQuery.fn,{hasParent:function(i){return this.filter(function(){return e(i).find(this).length})}})});